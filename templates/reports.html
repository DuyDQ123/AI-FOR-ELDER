{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-8 mx-auto">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">B√°o C√°o Tu·∫ßn</h4>
            </div>
            <div class="card-body">
                <!-- Th·ªëng k√™ t·ªïng quan -->
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="card bg-success text-white">
                            <div class="card-body">
                                <h5 class="card-title">ƒê√£ U·ªëng</h5>
                                <h2 class="mb-0">{{ stats.taken }}</h2>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-danger text-white">
                            <div class="card-body">
                                <h5 class="card-title">B·ªè L·ª°</h5>
                                <h2 class="mb-0">{{ stats.missed }}</h2>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-info text-white">
                            <div class="card-body">
                                <h5 class="card-title">T·ª∑ L·ªá Tu√¢n Th·ªß</h5>
                                <h2 class="mb-0">{{ "%.1f"|format(stats.compliance_rate) }}%</h2>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bi·ªÉu ƒë·ªì -->
                <div class="card mb-4">
                    <div class="card-body">
                        <canvas id="weeklyChart"></canvas>
                    </div>
                </div>

                <!-- L·ªùi khuy√™n -->
                <div class="alert alert-info">
                    {% if stats.compliance_rate >= 90 %}
                        <h5 class="alert-heading">R·∫•t t·ªët! üëè</h5>
                        <p>B·∫°n ƒë√£ tu√¢n th·ªß l·ªãch u·ªëng thu·ªëc r·∫•t t·ªët. H√£y duy tr√¨ th√≥i quen n√†y nh√©!</p>
                    {% elif stats.compliance_rate >= 70 %}
                        <h5 class="alert-heading">Kh√° t·ªët! üëç</h5>
                        <p>B·∫°n ƒë√£ th·ª±c hi·ªán t∆∞∆°ng ƒë·ªëi t·ªët. C·ªë g·∫Øng c·∫£i thi·ªán th√™m nh√©!</p>
                    {% else %}
                        <h5 class="alert-heading">C·∫ßn c·∫£i thi·ªán! üí™</h5>
                        <p>B·∫°n c·∫ßn c·ªë g·∫Øng tu√¢n th·ªß l·ªãch u·ªëng thu·ªëc t·ªët h∆°n ƒë·ªÉ ƒë·∫°t hi·ªáu qu·∫£ ƒëi·ªÅu tr·ªã cao nh·∫•t.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- D·ªØ li·ªáu cho bi·ªÉu ƒë·ªì -->
<div id="chart-data" 
     data-taken="{{ stats.taken }}"
     data-missed="{{ stats.missed }}"
     style="display: none;">
</div>

<!-- Script v·∫Ω bi·ªÉu ƒë·ªì -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
(function() {
    const chartData = document.getElementById('chart-data');
    const takenCount = parseInt(chartData.dataset.taken);
    const missedCount = parseInt(chartData.dataset.missed);
    
    const ctx = document.getElementById('weeklyChart').getContext('2d');
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['ƒê√£ U·ªëng', 'B·ªè L·ª°'],
            datasets: [{
                data: [takenCount, missedCount],
                backgroundColor: ['#198754', '#dc3545']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom'
                },
                title: {
                    display: true,
                    text: 'Th·ªëng K√™ Tu·∫ßn'
                }
            }
        }
    });
})();
</script>
{% endblock %}